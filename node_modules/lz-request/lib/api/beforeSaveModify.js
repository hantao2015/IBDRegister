"use strict";

var _httpCore = _interopRequireDefault(require("../httpCore"));

var _util = require("../util");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 修改保存记录前获取记录（通过计算公式计算得出）
 */

/**
 * 处理请求体
 * @param {object} reqBody 添加记录时发送给后端的请求体（未处理）
 *
 * @param {number} reqBody.resid 表资源 id
 * @param {array} reqBody.data 记录数组
 *
 */
var dealRequestBody = function dealRequestBody(reqBody) {
  var newReqBody = (0, _util.clone)(reqBody); // 防止改变传进来的 records ，从而影响外面

  var state = 'modified';
  newReqBody.data.forEach(function (record, index) {
    record._id = index + 1;
    record._state = state;
  });
  newReqBody.data = JSON.stringify(newReqBody.data);
  newReqBody.rp = {
    EnableFormulaVerify: 'false',
    EnableBitianCheck: false
  };
  return newReqBody;
};

_httpCore.default.createApi('beforeSaveModify', {
  method: 'post',
  url: '/api/100/table/RunInnerTableFormulaBeforeSave'
}, dealRequestBody);