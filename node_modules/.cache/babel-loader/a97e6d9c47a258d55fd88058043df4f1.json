{"ast":null,"code":"import _Spin from \"antd/es/spin\";\nimport _Upload from \"antd/es/upload\";\nimport _Form from \"antd/es/form\";\nimport _Input from \"antd/es/input\";\nimport _Table from \"antd/es/table\";\nimport _Button from \"antd/es/button\";\nimport _Icon from \"antd/es/icon\";\nimport _Modal from \"antd/es/modal\";\nimport _message from \"antd/es/message\";\nimport _Popconfirm from \"antd/es/popconfirm\";\nimport _Divider from \"antd/es/divider\";\nvar _jsxFileName = \"/Users/mac/Desktop/IBDRegister/src/components/busniess/UploadFile/UploadFile.js\";\nimport React, { Component } from \"react\";\nimport \"./UploadFile.less\";\nimport http from \"../../../utils/api\";\nconst fileId = \"621892190597\";\n\nconst columns = props => {\n  const onDown = props.onDown,\n        onDelete = props.onDelete;\n  return [{\n    title: \"序号\",\n    dataIndex: \"number\",\n    key: \"number\",\n    width: 50\n  }, {\n    title: \"文件名\",\n    dataIndex: \"fileName\",\n    key: \"fileName\",\n    width: 250\n  }, {\n    title: \"备注\",\n    dataIndex: \"remark\",\n    key: \"remark\",\n    width: 400\n  }, {\n    title: \"上传者\",\n    dataIndex: \"uploadPerson\",\n    key: \"uploadPerson\",\n    width: 150\n  }, {\n    title: \"上传时间\",\n    dataIndex: \"uploadDate\",\n    key: \"uploadDate\",\n    width: 150\n  }, {\n    title: \"操作\",\n    key: \"action\",\n    width: 150,\n    render: (text, record) => React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 57\n      },\n      __self: this\n    }, React.createElement(\"a\", {\n      onClick: () => {\n        onDown(record);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 58\n      },\n      __self: this\n    }, \"\\u4E0B\\u8F7D\"), React.createElement(_Divider, {\n      type: \"vertical\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 65\n      },\n      __self: this\n    }), React.createElement(_Popconfirm, {\n      title: \"\\u4F60\\u786E\\u5B9A\\u8981\\u63D0\\u4EA4\\u5417\",\n      onConfirm: () => {\n        onDelete(record);\n      },\n      okText: \"Yes\",\n      cancelText: \"No\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 66\n      },\n      __self: this\n    }, React.createElement(\"a\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74\n      },\n      __self: this\n    }, \"\\u5220\\u9664\")))\n  }];\n};\n\nconst uploadFile = (file, url) => {\n  return new Promise((resolve, reject) => {\n    let fd = new FormData();\n    fd.append(\"file\", file, file.name);\n    const xhr = new XMLHttpRequest();\n    xhr.open(\"POST\", url);\n\n    xhr.onload = () => {\n      const data = JSON.parse(xhr.response);\n\n      if (xhr.status === 200 && (data.error === 0 || data.error === \"0\")) {\n        const imgUrl = data.data;\n        resolve(imgUrl);\n      } else {\n        reject(data);\n      }\n    };\n\n    xhr.send(fd);\n  });\n};\n\nclass UploadFile extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      spin: false,\n      data: [],\n      record: {},\n      visible: false,\n      fileUrl: \"\"\n    };\n\n    this.componentDidMount = async () => {\n      await this.getData();\n    };\n\n    this.getData = async () => {\n      let res;\n      this.setState({\n        spin: true\n      });\n\n      try {\n        res = await http().getTable({\n          resid: fileId\n        });\n\n        if (res.data.error == 0) {\n          let data = [];\n          res.data.data.map((item, index) => {\n            item.number = index + 1;\n          });\n          this.setState({\n            data: res.data.data\n          });\n        }\n      } catch (error) {\n        _message.error(error.message);\n      }\n\n      this.setState({\n        spin: false\n      });\n    };\n\n    this.handleSubmit = e => {\n      this.props.form.validateFieldsAndScroll((err, values) => {\n        if (!err) {\n          this.onSubmit(values);\n        }\n      });\n    };\n\n    this.onDelete = async record => {\n      let res;\n\n      try {\n        res = await http().removeRecords({\n          resid: fileId,\n          data: [record]\n        });\n\n        if (res.data.Error == 0) {\n          _message.success(\"操作成功\");\n        }\n\n        this.setState({\n          visible: false\n        });\n        this.getData();\n      } catch (error) {\n        _message.error(error.message);\n      }\n    };\n\n    this.onDown = url => {\n      if (!url) {\n        return _Modal.warning({\n          title: \"您还未上传过资料\"\n        });\n      }\n\n      const urls = url.split(\";file;\");\n\n      for (let i = 0, len = urls.length; i < len; i++) {\n        window.open(urls[i]);\n      }\n    };\n\n    this.handleUploadFile = async fileInfo => {\n      const file = fileInfo.file;\n      const bucketname = \"realsun\";\n      const type = \"\";\n      const fileUrl = \"http://ivf.realsun.me:9001/api/AliyunOss/PutFilesObject?bucketname=\".concat(encodeURIComponent(bucketname), \"&srctype=\").concat(encodeURIComponent(type));\n\n      try {\n        await uploadFile(file, fileUrl).then(fileUrl => {\n          this.setState({\n            fileUrl: fileUrl[0]\n          });\n        });\n      } catch (err) {\n        return _message.error(err.message);\n      }\n    };\n\n    this.onSubmit = async values => {\n      let res;\n      let obj = {};\n      obj = {\n        fileName: values.fileName,\n        fileUrl: this.state.fileUrl,\n        remark: values.remark\n      };\n\n      try {\n        res = await http().addRecords({\n          resid: fileId,\n          data: [obj]\n        });\n\n        if (res.data.Error == 0) {\n          _message.success(\"操作成功\");\n        }\n\n        this.setState({\n          visible: false,\n          fileUrl: ''\n        });\n        this.getData();\n      } catch (error) {\n        _message.error(error.message);\n      }\n    };\n\n    this.onAdd = () => {\n      this.setState({\n        visible: true\n      });\n    };\n\n    this.handleCancel = () => {\n      this.setState({\n        visible: false\n      });\n    };\n\n    this.getBase64 = (img, callback) => {\n      const reader = new FileReader();\n      reader.addEventListener(\"load\", () => callback(reader.result));\n      reader.readAsDataURL(img);\n    };\n\n    this.handleChange = info => {\n      if (info.file.status === \"uploading\") {\n        return;\n      }\n\n      if (info.file.status === \"done\") {\n        // Get this url from response in real world.\n        this.getBase64(info.file.originFileObj, imageUrl => this.setState({\n          imageUrl\n        }));\n      }\n    };\n  }\n\n  render() {\n    const getFieldDecorator = this.props.form.getFieldDecorator;\n    const _this$state = this.state,\n          spin = _this$state.spin,\n          record = _this$state.record,\n          data = _this$state.data,\n          fileUrl = _this$state.fileUrl;\n    const formItemLayout = {\n      labelCol: {\n        xs: {\n          span: 24\n        },\n        sm: {\n          span: 8\n        }\n      },\n      wrapperCol: {\n        xs: {\n          span: 24\n        },\n        sm: {\n          span: 16\n        }\n      }\n    };\n    const tailFormItemLayout = {\n      wrapperCol: {\n        xs: {\n          span: 24,\n          offset: 0\n        },\n        sm: {\n          span: 16,\n          offset: 8\n        }\n      }\n    };\n    const uploadButton = React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 272\n      },\n      __self: this\n    }, React.createElement(_Icon, {\n      type: this.state.loading ? \"loading\" : \"plus\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"ant-upload-text\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 274\n      },\n      __self: this\n    }, \"Upload\"));\n    return React.createElement(\"div\", {\n      className: \"editNotice\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 279\n      },\n      __self: this\n    }, React.createElement(_Button, {\n      type: \"primary\",\n      className: \"editNotice-add\",\n      onClick: this.onAdd,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 280\n      },\n      __self: this\n    }, \"\\u4E0A\\u4F20\\u65B0\\u8D44\\u6599\"), React.createElement(_Spin, {\n      spinning: spin,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 283\n      },\n      __self: this\n    }, React.createElement(_Table, {\n      key: \"3\",\n      className: \"editNotice-table\",\n      columns: columns({\n        onDown: record => {\n          this.onDown(record.fileUrl);\n        },\n        onDelete: record => {\n          this.onDelete(record);\n        },\n        data: data\n      }),\n      scroll: {\n        x: 1000,\n        y: \"calc(100vh - 260px)\"\n      },\n      dataSource: data,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284\n      },\n      __self: this\n    }), React.createElement(_Modal, {\n      title: \"\\u4E0A\\u4F20\\u6587\\u4EF6\",\n      visible: this.state.visible,\n      width: 700,\n      onOk: this.handleOk,\n      onCancel: this.handleCancel,\n      destroyOnClose: true,\n      footer: [React.createElement(_Button, {\n        key: \"back\",\n        onClick: this.handleCancel,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 307\n        },\n        __self: this\n      }, \"\\u53D6\\u6D88\"), React.createElement(_Button, {\n        key: \"submit\",\n        type: \"primary\",\n        onClick: this.handleSubmit,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 310\n        },\n        __self: this\n      }, \"\\u63D0\\u4EA4\")],\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299\n      },\n      __self: this\n    }, React.createElement(_Form, Object.assign({}, formItemLayout, {\n      className: \"editNotice-form\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 315\n      },\n      __self: this\n    }), React.createElement(_Form.Item, {\n      className: \"editNotice-form-item\",\n      label: React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 318\n        },\n        __self: this\n      }, \"\\u8D44\\u6599\\u540D\\u79F0\\xA0\"),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 316\n      },\n      __self: this\n    }, getFieldDecorator(\"fileName\", {\n      rules: [{\n        required: true,\n        message: \"请输入申请人\",\n        whitespace: true\n      }]\n    })(React.createElement(_Input, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 328\n      },\n      __self: this\n    }))), React.createElement(_Form.Item, {\n      className: \"editNotice-form-item\",\n      label: React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 332\n        },\n        __self: this\n      }, \"\\u5907\\u6CE8\\xA0\"),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 330\n      },\n      __self: this\n    }, getFieldDecorator(\"remark\", {\n      rules: [{\n        required: true,\n        message: \"请输入备注\",\n        whitespace: true\n      }]\n    })(React.createElement(_Input, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 342\n      },\n      __self: this\n    }))), React.createElement(_Form.Item, {\n      className: \"editNotice-form-item\",\n      label: React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 346\n        },\n        __self: this\n      }, \"\\u8D44\\u6599\\xA0\"),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 344\n      },\n      __self: this\n    }, getFieldDecorator(\"file\", {\n      rules: [{\n        required: true,\n        message: \"请输入申请人\",\n        whitespace: true\n      }]\n    })(React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 357\n      },\n      __self: this\n    }, React.createElement(_Upload, {\n      name: \"file\",\n      showUploadList: false,\n      customRequest: this.handleUploadFile,\n      onRemove: this.handleRemoveFile,\n      onChange: this.handleChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 358\n      },\n      __self: this\n    }, React.createElement(_Button, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 365\n      },\n      __self: this\n    }, React.createElement(_Icon, {\n      type: \"upload\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 366\n      },\n      __self: this\n    }), \" \\u4E0A\\u4F20\")), React.createElement(_Input, {\n      style: {\n        display: \"none\"\n      },\n      value: fileUrl,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 369\n      },\n      __self: this\n    }))), React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 372\n      },\n      __self: this\n    }, React.createElement(\"a\", {\n      href: fileUrl,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 373\n      },\n      __self: this\n    }, fileUrl)))))));\n  }\n\n}\n\nexport default _Form.create()(UploadFile);","map":{"version":3,"sources":["/Users/mac/Desktop/IBDRegister/src/components/busniess/UploadFile/UploadFile.js"],"names":["React","Component","http","fileId","columns","props","onDown","onDelete","title","dataIndex","key","width","render","text","record","uploadFile","file","url","Promise","resolve","reject","fd","FormData","append","name","xhr","XMLHttpRequest","open","onload","data","JSON","parse","response","status","error","imgUrl","send","UploadFile","state","spin","visible","fileUrl","componentDidMount","getData","res","setState","getTable","resid","map","item","index","number","message","handleSubmit","e","form","validateFieldsAndScroll","err","values","onSubmit","removeRecords","Error","success","warning","urls","split","i","len","length","window","handleUploadFile","fileInfo","bucketname","type","encodeURIComponent","then","obj","fileName","remark","addRecords","onAdd","handleCancel","getBase64","img","callback","reader","FileReader","addEventListener","result","readAsDataURL","handleChange","info","originFileObj","imageUrl","getFieldDecorator","formItemLayout","labelCol","xs","span","sm","wrapperCol","tailFormItemLayout","offset","uploadButton","loading","x","y","handleOk","rules","required","whitespace","handleRemoveFile","display","create"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport \"./UploadFile.less\";\nimport {\n  Icon,\n  Input,\n  Upload,\n  Button,\n  Form,\n  message,\n  Spin,\n  Modal,\n  Table,\n  Divider,\n  Popconfirm\n} from \"antd\";\nimport http from \"../../../utils/api\";\n\nconst fileId = \"621892190597\";\nconst columns = props => {\n  const { onDown, onDelete } = props;\n  return [\n    {\n      title: \"序号\",\n      dataIndex: \"number\",\n      key: \"number\",\n      width: 50\n    },\n    {\n      title: \"文件名\",\n      dataIndex: \"fileName\",\n      key: \"fileName\",\n      width: 250\n    },\n    {\n      title: \"备注\",\n      dataIndex: \"remark\",\n      key: \"remark\",\n      width: 400\n    },\n    {\n      title: \"上传者\",\n      dataIndex: \"uploadPerson\",\n      key: \"uploadPerson\",\n      width: 150\n    },\n    {\n      title: \"上传时间\",\n      dataIndex: \"uploadDate\",\n      key: \"uploadDate\",\n      width: 150\n    },\n    {\n      title: \"操作\",\n      key: \"action\",\n      width: 150,\n      render: (text, record) => (\n        <span>\n          <a\n            onClick={() => {\n              onDown(record);\n            }}\n          >\n            下载\n          </a>\n          <Divider type=\"vertical\" />\n          <Popconfirm\n            title=\"你确定要提交吗\"\n            onConfirm={() => {\n              onDelete(record);\n            }}\n            okText=\"Yes\"\n            cancelText=\"No\"\n          >\n            <a>删除</a>\n          </Popconfirm>\n        </span>\n      )\n    }\n  ];\n};\nconst uploadFile = (file, url) => {\n  return new Promise((resolve, reject) => {\n    let fd = new FormData();\n    fd.append(\"file\", file, file.name);\n    const xhr = new XMLHttpRequest();\n    xhr.open(\"POST\", url);\n    xhr.onload = () => {\n      const data = JSON.parse(xhr.response);\n      if (xhr.status === 200 && (data.error === 0 || data.error === \"0\")) {\n        const imgUrl = data.data;\n        resolve(imgUrl);\n      } else {\n        reject(data);\n      }\n    };\n    xhr.send(fd);\n  });\n};\nclass UploadFile extends Component {\n  state = {\n    spin: false,\n    data: [],\n    record: {},\n    visible: false,\n    fileUrl: \"\"\n  };\n  componentDidMount = async () => {\n    await this.getData();\n  };\n  //获取文件表记录\n  getData = async () => {\n    let res;\n    this.setState({\n      spin: true\n    });\n    try {\n      res = await http().getTable({\n        resid: fileId\n      });\n      if (res.data.error == 0) {\n        let data = [];\n        res.data.data.map((item,index) => {\n          item.number = index+1;\n        })\n        this.setState({\n          data: res.data.data\n        });\n      }\n    } catch (error) {\n      message.error(error.message);\n    }\n    this.setState({\n      spin: false\n    });\n  };\n\n  handleSubmit = e => {\n    this.props.form.validateFieldsAndScroll((err, values) => {\n      if (!err) {\n        this.onSubmit(values);\n      }\n    });\n  };\n  onDelete = async record => {\n    let res;\n    try {\n      res = await http().removeRecords({\n        resid: fileId,\n        data: [record]\n      });\n      if (res.data.Error == 0) {\n        message.success(\"操作成功\");\n      }\n      this.setState({\n        visible: false\n      });\n      this.getData();\n    } catch (error) {\n      message.error(error.message);\n    }\n  };\n  //下载文件\n  onDown = url => {\n    if (!url) {\n      return Modal.warning({\n        title: \"您还未上传过资料\"\n      });\n    }\n    const urls = url.split(\";file;\");\n    for (let i = 0, len = urls.length; i < len; i++) {\n      window.open(urls[i]);\n    }\n  };\n  //上传文件\n  handleUploadFile = async fileInfo => {\n    const file = fileInfo.file;\n    const bucketname = \"realsun\";\n    const type = \"\";\n    const fileUrl = `http://ivf.realsun.me:9001/api/AliyunOss/PutFilesObject?bucketname=${encodeURIComponent(\n      bucketname\n    )}&srctype=${encodeURIComponent(type)}`;\n    try {\n      await uploadFile(file, fileUrl).then(fileUrl => {\n        this.setState({\n          fileUrl:fileUrl[0]\n        });\n      });\n    } catch (err) {\n      return message.error(err.message);\n    }\n  };\n  //提交表单\n  onSubmit = async values => {\n    let res;\n    let obj = {};\n    obj = {\n      fileName: values.fileName,\n      fileUrl: this.state.fileUrl,\n      remark:values.remark\n    };\n    try {\n      res = await http().addRecords({\n        resid: fileId,\n        data: [obj]\n      });\n      if (res.data.Error == 0) {\n        message.success(\"操作成功\");\n      }\n      this.setState({\n        visible: false,\n        fileUrl:''\n      });\n      this.getData();\n    } catch (error) {\n      message.error(error.message);\n    }\n  };\n  onAdd = () => {\n    this.setState({\n      visible: true\n    });\n  };\n  handleCancel = () => {\n    this.setState({\n      visible: false\n    });\n  };\n  getBase64 = (img, callback) => {\n    const reader = new FileReader();\n    reader.addEventListener(\"load\", () => callback(reader.result));\n    reader.readAsDataURL(img);\n  };\n  handleChange = info => {\n    if (info.file.status === \"uploading\") {\n      return;\n    }\n    if (info.file.status === \"done\") {\n      // Get this url from response in real world.\n      this.getBase64(info.file.originFileObj, imageUrl =>\n        this.setState({\n          imageUrl\n        })\n      );\n    }\n  };\n  render() {\n    const { getFieldDecorator } = this.props.form;\n    const { spin, record, data, fileUrl } = this.state;\n    const formItemLayout = {\n      labelCol: {\n        xs: { span: 24 },\n        sm: { span: 8 }\n      },\n      wrapperCol: {\n        xs: { span: 24 },\n        sm: { span: 16 }\n      }\n    };\n    const tailFormItemLayout = {\n      wrapperCol: {\n        xs: {\n          span: 24,\n          offset: 0\n        },\n        sm: {\n          span: 16,\n          offset: 8\n        }\n      }\n    };\n    const uploadButton = (\n      <div>\n        <Icon type={this.state.loading ? \"loading\" : \"plus\"} />\n        <div className=\"ant-upload-text\">Upload</div>\n      </div>\n    );\n\n    return (\n      <div className=\"editNotice\">\n        <Button type=\"primary\" className=\"editNotice-add\" onClick={this.onAdd}>\n          上传新资料\n        </Button>\n        <Spin spinning={spin}>\n          <Table\n            key=\"3\"\n            className=\"editNotice-table\"\n            columns={columns({\n              onDown: record => {\n                this.onDown(record.fileUrl);\n              },\n              onDelete: record => {\n                this.onDelete(record);\n              },\n              data: data\n            })}\n            scroll={{ x: 1000, y: \"calc(100vh - 260px)\" }}\n            dataSource={data}\n          />\n          <Modal\n            title=\"上传文件\"\n            visible={this.state.visible}\n            width={700}\n            onOk={this.handleOk}\n            onCancel={this.handleCancel}\n            destroyOnClose\n            footer={[\n              <Button key=\"back\" onClick={this.handleCancel}>\n                取消\n              </Button>,\n              <Button key=\"submit\" type=\"primary\" onClick={this.handleSubmit}>\n                提交\n              </Button>\n            ]}\n          >\n            <Form {...formItemLayout} className=\"editNotice-form\">\n              <Form.Item\n                className=\"editNotice-form-item\"\n                label={<span>资料名称&nbsp;</span>}\n              >\n                {getFieldDecorator(\"fileName\", {\n                  rules: [\n                    {\n                      required: true,\n                      message: \"请输入申请人\",\n                      whitespace: true\n                    }\n                  ]\n                })(<Input />)}\n              </Form.Item>  \n               <Form.Item\n                className=\"editNotice-form-item\"\n                label={<span>备注&nbsp;</span>}\n              >\n                {getFieldDecorator(\"remark\", {\n                  rules: [\n                    {\n                      required: true,\n                      message: \"请输入备注\",\n                      whitespace: true\n                    }\n                  ]\n                })(<Input />)}\n              </Form.Item>\n              <Form.Item\n                className=\"editNotice-form-item\"\n                label={<span>资料&nbsp;</span>}\n              >\n                {getFieldDecorator(\"file\", {\n                  rules: [\n                    {\n                      required: true,\n                      message: \"请输入申请人\",\n                      whitespace: true\n                    }\n                  ]\n                })(\n                  <div>\n                    <Upload\n                      name=\"file\"\n                      showUploadList={false}\n                      customRequest={this.handleUploadFile}\n                      onRemove={this.handleRemoveFile}\n                      onChange={this.handleChange}\n                    >\n                      <Button>\n                        <Icon type=\"upload\" /> 上传\n                      </Button>\n                    </Upload>\n                    <Input style={{ display: \"none\" }} value={fileUrl} />\n                  </div>\n                )}\n                <div>\n                  <a href={fileUrl}>{fileUrl}</a>\n                </div>\n              </Form.Item>\n            </Form>\n          </Modal>\n        </Spin>\n      </div>\n    );\n  }\n}\n\nexport default Form.create()(UploadFile);\n"]},"metadata":{},"sourceType":"module"}