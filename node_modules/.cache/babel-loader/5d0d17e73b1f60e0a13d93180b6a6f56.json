{"ast":null,"code":"import _Form from \"antd/es/form\";\nimport _Spin from \"antd/es/spin\";\nimport _Table from \"antd/es/table\";\nimport _Icon from \"antd/es/icon\";\nimport _Modal from \"antd/es/modal\";\nimport _message from \"antd/es/message\";\nimport _Input from \"antd/es/input\";\nvar _jsxFileName = \"/Users/mac/Desktop/IBDRegister/src/components/busniess/DownFile/DownFile.js\";\nimport React, { Component } from \"react\";\nimport \"./DownFile.less\";\nimport http from \"../../../utils/api\";\nconst fileId = '621892190597';\nconst TextArea = _Input.TextArea;\n\nconst columns = props => {\n  const onDown = props.onDown;\n  return [{\n    title: \"文件名\",\n    dataIndex: \"fileName\",\n    key: \"fileName\",\n    width: 250\n  }, {\n    title: \"文件地址\",\n    dataIndex: \"fileUrl\",\n    key: \"fileUrl\",\n    width: 400\n  }, {\n    title: \"上传者\",\n    dataIndex: \"uploadPerson\",\n    key: \"uploadPerson\",\n    width: 150\n  }, {\n    title: \"上传时间\",\n    dataIndex: \"uploadDate\",\n    key: \"uploadDate\",\n    width: 150\n  }, {\n    title: \"操作\",\n    key: \"action\",\n    width: 150,\n    render: (text, record) => React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 51\n      },\n      __self: this\n    }, React.createElement(\"a\", {\n      onClick: () => {\n        onDown(record);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 52\n      },\n      __self: this\n    }, \"\\u4E0B\\u8F7D\"))\n  }];\n};\n\nclass DownFile extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      spin: false,\n      data: [],\n      record: {},\n      visible: false,\n      fileUrl: \"\"\n    };\n\n    this.getData = async () => {\n      let res;\n      this.setState({\n        loading: true\n      });\n\n      try {\n        res = await http().getTable({\n          resid: fileId\n        });\n\n        if (res.data.error == 0) {\n          this.setState({\n            data: res.data.data\n          });\n        }\n      } catch (error) {\n        _message.error(error.message);\n      }\n\n      this.setState({\n        loading: false\n      });\n    };\n\n    this.handleSubmit = e => {\n      this.props.form.validateFieldsAndScroll((err, values) => {\n        if (!err) {\n          this.onSubmit(values);\n        }\n      });\n    };\n\n    this.onDown = url => {\n      if (!url) {\n        return _Modal.warning({\n          title: '您还未上传过资料'\n        });\n      }\n\n      const urls = url.split(';file;');\n\n      for (let i = 0, len = urls.length; i < len; i++) {\n        window.open(urls[i]);\n      }\n    };\n\n    this.handleUploadFile = async fileInfo => {\n      const file = fileInfo.file;\n      const bucketname = \"realsun\";\n      const type = \"\";\n      const fileUrl = \"http://ivf.realsun.me:9001/api/AliyunOss/PutOneImageObject?bucketname=\".concat(encodeURIComponent(bucketname), \"&srctype=\").concat(encodeURIComponent(type));\n\n      try {\n        await uploadFile(file, fileUrl).then(fileUrl => {\n          this.setState({\n            fileUrl\n          });\n        });\n      } catch (err) {\n        return _message.error(err.message);\n      }\n    };\n\n    this.handleCancel = () => {\n      this.setState({\n        visible: false\n      });\n    };\n\n    this.getBase64 = (img, callback) => {\n      const reader = new FileReader();\n      reader.addEventListener(\"load\", () => callback(reader.result));\n      reader.readAsDataURL(img);\n    };\n\n    this.handleChange = info => {\n      console.log(\"info\", info);\n\n      if (info.file.status === \"uploading\") {\n        return;\n      }\n\n      if (info.file.status === \"done\") {\n        // Get this url from response in real world.\n        this.getBase64(info.file.originFileObj, imageUrl => this.setState({\n          imageUrl\n        }));\n      }\n    };\n  }\n\n  componentDidMount() {\n    this.getData();\n  } //获取文件表记录\n\n\n  render() {\n    const getFieldDecorator = this.props.form.getFieldDecorator;\n    const _this$state = this.state,\n          spin = _this$state.spin,\n          record = _this$state.record,\n          data = _this$state.data,\n          fileUrl = _this$state.fileUrl;\n    const formItemLayout = {\n      labelCol: {\n        xs: {\n          span: 24\n        },\n        sm: {\n          span: 8\n        }\n      },\n      wrapperCol: {\n        xs: {\n          span: 24\n        },\n        sm: {\n          span: 16\n        }\n      }\n    };\n    const tailFormItemLayout = {\n      wrapperCol: {\n        xs: {\n          span: 24,\n          offset: 0\n        },\n        sm: {\n          span: 16,\n          offset: 8\n        }\n      }\n    };\n    const uploadButton = React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187\n      },\n      __self: this\n    }, React.createElement(_Icon, {\n      type: this.state.loading ? \"loading\" : \"plus\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"ant-upload-text\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189\n      },\n      __self: this\n    }, \"Upload\"));\n    return React.createElement(\"div\", {\n      className: \"editNotice\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194\n      },\n      __self: this\n    }, React.createElement(_Spin, {\n      spinning: spin,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195\n      },\n      __self: this\n    }, React.createElement(_Table, {\n      key: \"3\",\n      className: \"editNotice-table\",\n      columns: columns({\n        onDown: record => {\n          this.onDown(record.fileUrl);\n        },\n        data: data\n      }),\n      scroll: {\n        x: 1000,\n        y: \"calc(100vh - 260px)\"\n      },\n      dataSource: data,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196\n      },\n      __self: this\n    })));\n  }\n\n}\n\nexport default _Form.create()(DownFile);","map":{"version":3,"sources":["/Users/mac/Desktop/IBDRegister/src/components/busniess/DownFile/DownFile.js"],"names":["React","Component","http","fileId","TextArea","columns","props","onDown","title","dataIndex","key","width","render","text","record","DownFile","state","spin","data","visible","fileUrl","getData","res","setState","loading","getTable","resid","error","message","handleSubmit","e","form","validateFieldsAndScroll","err","values","onSubmit","url","warning","urls","split","i","len","length","window","open","handleUploadFile","fileInfo","file","bucketname","type","encodeURIComponent","uploadFile","then","handleCancel","getBase64","img","callback","reader","FileReader","addEventListener","result","readAsDataURL","handleChange","info","console","log","status","originFileObj","imageUrl","componentDidMount","getFieldDecorator","formItemLayout","labelCol","xs","span","sm","wrapperCol","tailFormItemLayout","offset","uploadButton","x","y","create"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport \"./DownFile.less\";\nimport {\n  Collapse,\n  Icon,\n  Input,\n  Upload,\n  Button,\n  Form,\n  message,\n  Spin,\n  Modal,\n  Table\n} from \"antd\";\nimport http from \"../../../utils/api\";\n\nconst fileId = '621892190597'\nconst { TextArea } = Input;\nconst columns = props => {\n  const { onDown} = props;\n  return [\n    {\n      title: \"文件名\",\n      dataIndex: \"fileName\",\n      key: \"fileName\",\n      width: 250,\n    },\n    {\n      title: \"文件地址\",\n      dataIndex: \"fileUrl\",\n      key: \"fileUrl\",\n      width: 400\n    },\n    {\n      title: \"上传者\",\n      dataIndex: \"uploadPerson\",\n      key: \"uploadPerson\",\n      width: 150\n    },\n    {\n      title: \"上传时间\",\n      dataIndex: \"uploadDate\",\n      key: \"uploadDate\",\n      width: 150\n    },\n    {\n      title: \"操作\",\n      key: \"action\",\n      width: 150,\n      render: (text, record) => (\n        <span>\n          <a\n            onClick={() => {\n              onDown(record);\n            }}\n          >\n            下载\n          </a>\n        </span>\n      )\n    }\n  ];\n};\nclass DownFile extends Component {\n  state = {\n    spin: false,\n    data: [],\n    record: {},\n    visible: false,\n    fileUrl: \"\"\n  };\n  componentDidMount() {\n    this.getData();\n  }\n\n  //获取文件表记录\n  getData = async () => {\n    let res;\n    this.setState({\n      loading: true\n    });\n    try {\n      res = await http().getTable({\n        resid: fileId\n      });\n      if (res.data.error == 0) {\n        this.setState({\n          data: res.data.data\n        });\n      }\n    } catch (error) {\n      message.error(error.message);\n    }\n    this.setState({\n      loading: false\n    });\n  };\n\n  handleSubmit = (e) => {\n    this.props.form.validateFieldsAndScroll((err, values) => {\n      if (!err) {\n        this.onSubmit(values);\n      }\n    });\n  };\n  //下载文件\n  onDown = url => {\n    if (!url) {\n      return Modal.warning({\n        title: '您还未上传过资料'\n      });\n    }\n    const urls = url.split(';file;');\n    for (let i = 0, len = urls.length; i < len; i++) {\n      window.open(urls[i]);\n    }\n  };\n  //上传文件\n  handleUploadFile = async fileInfo => {\n    const file = fileInfo.file;\n    const bucketname = \"realsun\";\n    const type = \"\";\n    const fileUrl = `http://ivf.realsun.me:9001/api/AliyunOss/PutOneImageObject?bucketname=${encodeURIComponent(\n      bucketname\n    )}&srctype=${encodeURIComponent(type)}`;\n    try {\n      await uploadFile(file, fileUrl).then(fileUrl => {\n        this.setState({\n          fileUrl\n        });\n      });\n    } catch (err) {\n      return message.error(err.message);\n    }\n  };\n\n  handleCancel = () => {\n    this.setState({\n      visible:false\n    })\n  }\n  getBase64 = (img, callback) => {\n    const reader = new FileReader();\n    reader.addEventListener(\"load\", () => callback(reader.result));\n    reader.readAsDataURL(img);\n  };\n  handleChange = info => {\n    console.log(\"info\", info);\n    if (info.file.status === \"uploading\") {\n      return;\n    }\n    if (info.file.status === \"done\") {\n      // Get this url from response in real world.\n      this.getBase64(info.file.originFileObj, imageUrl =>\n        this.setState({\n          imageUrl\n        })\n      );\n    }\n  };\n  render() {\n    const { getFieldDecorator } = this.props.form;\n    const { spin, record, data, fileUrl } = this.state;\n    const formItemLayout = {\n      labelCol: {\n        xs: { span: 24 },\n        sm: { span: 8 }\n      },\n      wrapperCol: {\n        xs: { span: 24 },\n        sm: { span: 16 }\n      }\n    };\n    const tailFormItemLayout = {\n      wrapperCol: {\n        xs: {\n          span: 24,\n          offset: 0\n        },\n        sm: {\n          span: 16,\n          offset: 8\n        }\n      }\n    };\n    const uploadButton = (\n      <div>\n        <Icon type={this.state.loading ? \"loading\" : \"plus\"} />\n        <div className=\"ant-upload-text\">Upload</div>\n      </div>\n    );\n\n    return (\n      <div className=\"editNotice\">\n        <Spin spinning={spin}>\n          <Table\n            key=\"3\"\n            className=\"editNotice-table\"\n            columns={columns({\n              onDown: record => {\n                this.onDown(record.fileUrl);\n              },\n              data: data\n            })}\n            scroll={{ x: 1000, y: \"calc(100vh - 260px)\" }}\n            dataSource={data}\n          />\n        </Spin>\n      </div>\n    );\n  }\n}\n\nexport default Form.create()(DownFile);\n"]},"metadata":{},"sourceType":"module"}